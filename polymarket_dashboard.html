<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Polymarket Live Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;600" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #0a0a14;
    --card-bg: rgba(16,16,32,0.85);
    --cyan: #00ffc3;
    --green: #00ff88;
    --red: #ff3355;
    --yellow: #ffcc00;
    --purple: #a855f7;
    --blue: #00aaff;
    --dim: #6b7a8d;
    --card-border: rgba(0,255,195,0.12);
  }

  body {
    background: var(--bg);
    color: #e0e6ed;
    font-family: 'Inter', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* Grid overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,255,195,0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,195,0.02) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
    z-index: 0;
  }

  /* Radial gradient pulses */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 60% 40% at 50% 10%, rgba(0,170,255,0.08), transparent),
      radial-gradient(ellipse 50% 50% at 80% 90%, rgba(168,85,247,0.06), transparent);
    animation: bgPulse 8s ease-in-out infinite alternate;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes bgPulse {
    0% { opacity: 0.6; }
    100% { opacity: 1; }
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 32px 24px 48px;
    position: relative;
    z-index: 1;
  }

  /* Title */
  .title {
    font-family: 'Orbitron', sans-serif;
    font-weight: 900;
    font-size: 2.4rem;
    color: var(--cyan);
    text-align: center;
    letter-spacing: 4px;
    text-shadow: 0 0 24px rgba(0,255,195,0.5), 0 0 60px rgba(0,255,195,0.2);
    animation: glowPulse 3s ease-in-out infinite alternate;
    margin-bottom: 6px;
  }

  @keyframes glowPulse {
    0% { text-shadow: 0 0 24px rgba(0,255,195,0.5), 0 0 60px rgba(0,255,195,0.2); }
    100% { text-shadow: 0 0 36px rgba(0,255,195,0.7), 0 0 80px rgba(0,255,195,0.35); }
  }

  .subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    color: var(--dim);
    text-align: center;
    letter-spacing: 2px;
    margin-bottom: 12px;
  }

  /* Status pill */
  .status-pill {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 32px;
  }

  .status-pill-inner {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(0,255,136,0.06);
    border: 1px solid rgba(0,255,136,0.25);
    border-radius: 24px;
    padding: 8px 22px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    color: var(--green);
    letter-spacing: 1px;
  }

  .live-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--green);
    box-shadow: 0 0 8px var(--green);
    animation: dotPulse 1.5s ease-in-out infinite;
  }

  @keyframes dotPulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 8px var(--green); }
    50% { opacity: 0.5; box-shadow: 0 0 16px var(--green); }
  }

  /* Cards grid */
  .cards-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    margin-bottom: 28px;
  }

  .card {
    background: var(--card-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: transform 0.25s ease, border-color 0.25s ease;
    animation: fadeUp 0.6s ease-out backwards;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
    opacity: 0.6;
  }

  .card:hover {
    transform: translateY(-2px);
    border-color: rgba(0,255,195,0.3);
  }

  .card:nth-child(1) { animation-delay: 0s; }
  .card:nth-child(2) { animation-delay: 0.05s; }
  .card:nth-child(3) { animation-delay: 0.1s; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .card-title {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 0.95rem;
    color: var(--cyan);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 12px;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .badge-green {
    color: var(--green);
    border: 1px solid rgba(0,255,136,0.4);
    background: rgba(0,255,136,0.08);
  }

  .badge-blue {
    color: var(--blue);
    border: 1px solid rgba(0,170,255,0.4);
    background: rgba(0,170,255,0.08);
  }

  .badge-yellow {
    color: var(--yellow);
    border: 1px solid rgba(255,204,0,0.4);
    background: rgba(255,204,0,0.08);
  }

  .stat-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 16px;
    margin-bottom: 14px;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .stat-label {
    font-family: 'Inter', sans-serif;
    font-size: 0.65rem;
    color: var(--dim);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.95rem;
    font-weight: 700;
  }

  .stat-value.profit { color: var(--green); }
  .stat-value.loss { color: var(--red); }
  .stat-value.neutral { color: var(--cyan); }
  .stat-value.warn { color: var(--yellow); }

  .card-note {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--dim);
    border-top: 1px solid rgba(0,255,195,0.08);
    padding-top: 10px;
    margin-top: 6px;
    line-height: 1.5;
  }

  /* Hero card special */
  .card.hero {
    border-color: rgba(0,255,195,0.2);
    background: rgba(16,16,32,0.92);
  }

  .card.hero::before {
    opacity: 1;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--cyan), var(--green), var(--cyan), transparent);
  }

  .hero-pnl {
    font-family: 'Orbitron', sans-serif;
    font-weight: 900;
    font-size: 2.6rem;
    color: var(--green);
    text-shadow: 0 0 20px rgba(0,255,136,0.4);
    text-align: center;
    margin: 8px 0 4px;
  }

  .hero-wr {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 1.6rem;
    color: var(--cyan);
    text-align: center;
    margin-bottom: 4px;
  }

  .hero-record {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    color: var(--dim);
    text-align: center;
    margin-bottom: 16px;
  }

  /* Streak boxes */
  .streak-row {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin: 12px 0 8px;
    flex-wrap: wrap;
  }

  .streak-box {
    width: 28px;
    height: 28px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    font-weight: 700;
    color: #fff;
    transition: transform 0.15s;
    cursor: default;
  }

  .streak-box:hover {
    transform: scale(1.2);
  }

  .streak-box.win {
    background: rgba(0,255,136,0.2);
    border: 1px solid rgba(0,255,136,0.5);
    color: var(--green);
  }

  .streak-box.loss {
    background: rgba(255,51,85,0.2);
    border: 1px solid rgba(255,51,85,0.5);
    color: var(--red);
  }

  /* Charts */
  .chart-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 28px;
  }

  .chart-card {
    background: var(--card-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
    animation: fadeUp 0.6s ease-out backwards;
    animation-delay: 0.15s;
  }

  .chart-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
    opacity: 0.6;
  }

  .chart-title {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 0.8rem;
    color: var(--cyan);
    margin-bottom: 14px;
    letter-spacing: 1px;
  }

  .chart-container {
    position: relative;
    max-height: 340px;
    height: 300px;
  }

  /* Trade log table */
  .table-card {
    background: var(--card-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
    margin-bottom: 28px;
    animation: fadeUp 0.6s ease-out backwards;
    animation-delay: 0.2s;
  }

  .table-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
    opacity: 0.6;
  }

  .table-title {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 0.8rem;
    color: var(--cyan);
    margin-bottom: 14px;
    letter-spacing: 1px;
  }

  .trade-table {
    width: 100%;
    border-collapse: collapse;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
  }

  .trade-table th {
    color: var(--dim);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 0.6rem;
    padding: 8px 10px;
    text-align: left;
    border-bottom: 1px solid rgba(0,255,195,0.1);
    white-space: nowrap;
  }

  .trade-table td {
    padding: 7px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    white-space: nowrap;
  }

  .trade-table tr:hover td {
    background: rgba(0,255,195,0.03);
  }

  .bot-mom { color: var(--purple); font-weight: 700; }
  .bot-snp { color: var(--blue); font-weight: 700; }
  .side-up { color: var(--green); font-weight: 600; }
  .side-down { color: var(--red); font-weight: 600; }
  .result-win { color: var(--green); font-weight: 700; }
  .result-loss { color: var(--red); font-weight: 700; }

  /* Footer */
  .footer {
    text-align: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--dim);
    padding: 24px 0 8px;
    border-top: 1px solid rgba(0,255,195,0.06);
    letter-spacing: 1px;
    animation: fadeUp 0.6s ease-out backwards;
    animation-delay: 0.25s;
  }

  /* Responsive */
  @media (max-width: 1000px) {
    .cards-row { grid-template-columns: 1fr; }
    .chart-section { grid-template-columns: 1fr; }
    .title { font-size: 1.6rem; }
  }
</style>
</head>
<body>
<div class="container">

  <!-- TITLE -->
  <div class="title">POLYMARKET LIVE DASHBOARD</div>
  <div class="subtitle">FEB 19&ndash;20, 2026 &mdash; ALL LIVE SESSIONS</div>

  <!-- STATUS PILL -->
  <div class="status-pill">
    <div class="status-pill-inner">
      <span class="live-dot"></span>
      <span>2 BOTS ACTIVE &mdash; <span id="mst-clock"></span></span>
    </div>
  </div>

  <!-- STRATEGY CARDS -->
  <div class="cards-row">

    <!-- Sniper 5M -->
    <div class="card">
      <div class="card-title">
        SNIPER 5M V2.3
        <span class="badge badge-green">LIVE</span>
      </div>
      <div class="stat-grid">
        <div class="stat-item">
          <span class="stat-label">Record</span>
          <span class="stat-value neutral">12W / 3L</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Win Rate</span>
          <span class="stat-value profit">80%</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total PnL</span>
          <span class="stat-value profit">+$3.33</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Trade Size</span>
          <span class="stat-value neutral">$3.00/trade</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Win</span>
          <span class="stat-value profit">+$1.06</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Loss</span>
          <span class="stat-value loss">-$3.12</span>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
        <span class="stat-label" style="margin:0;">HMM:</span>
        <span class="badge badge-blue">ML Active</span>
      </div>
      <div class="card-note">ML filter active &mdash; 8+ data points collected</div>
    </div>

    <!-- Momentum 15M -->
    <div class="card">
      <div class="card-title">
        MOMENTUM 15M V2.5
        <span class="badge badge-green">PROMOTED</span>
      </div>
      <div class="stat-grid">
        <div class="stat-item">
          <span class="stat-label">Record</span>
          <span class="stat-value neutral">1W / 1L</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Win Rate</span>
          <span class="stat-value warn">50%</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total PnL</span>
          <span class="stat-value loss">-$0.39</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Trade Size</span>
          <span class="stat-value neutral">$5.00/trade</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Win</span>
          <span class="stat-value profit">+$2.65</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Loss</span>
          <span class="stat-value loss">-$3.04</span>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
        <span class="stat-label" style="margin:0;">HMM:</span>
        <span class="badge badge-yellow">MEAN_REVERT</span>
      </div>
      <div class="card-note">V2.5 deployed &mdash; FRAMA/consensus RSI exempt, MAX_ENTRY $0.80</div>
    </div>

    <!-- HERO Combined -->
    <div class="card hero">
      <div class="card-title" style="justify-content:center;">COMBINED PERFORMANCE</div>
      <div class="hero-pnl">+$2.94</div>
      <div class="hero-wr">76% WR</div>
      <div class="hero-record">13W / 4L</div>
      <div class="stat-grid">
        <div class="stat-item">
          <span class="stat-label">Avg Win</span>
          <span class="stat-value profit">+$1.18</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Loss</span>
          <span class="stat-value loss">-$3.10</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">W:L Ratio</span>
          <span class="stat-value warn">0.38x</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Best Trade</span>
          <span class="stat-value profit">+$2.65</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Worst Trade</span>
          <span class="stat-value loss">-$3.57</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total Trades</span>
          <span class="stat-value neutral">17</span>
        </div>
      </div>
      <!-- Streak boxes: chronological W/L sequence -->
      <div class="streak-row">
        <div class="streak-box win" title="#1 MOM +$2.65">W</div>
        <div class="streak-box loss" title="#2 SNP -$2.96">L</div>
        <div class="streak-box win" title="#3 SNP +$1.25">W</div>
        <div class="streak-box win" title="#4 SNP +$1.06">W</div>
        <div class="streak-box win" title="#5 SNP +$1.41">W</div>
        <div class="streak-box win" title="#6 SNP +$1.31">W</div>
        <div class="streak-box win" title="#7 SNP +$1.04">W</div>
        <div class="streak-box win" title="#8 SNP +$0.74">W</div>
        <div class="streak-box win" title="#9 SNP +$0.69">W</div>
        <div class="streak-box win" title="#10 SNP +$1.21">W</div>
        <div class="streak-box loss" title="#11 MOM -$3.04">L</div>
        <div class="streak-box win" title="#12 SNP +$1.06">W</div>
        <div class="streak-box win" title="#13 SNP +$1.03">W</div>
        <div class="streak-box win" title="#14 SNP +$0.61">W</div>
        <div class="streak-box loss" title="#15 SNP -$2.84">L</div>
        <div class="streak-box win" title="#16 SNP +$1.29">W</div>
        <div class="streak-box loss" title="#17 SNP -$3.57">L</div>
      </div>
      <div class="card-note" style="text-align:center;">Sniper carrying the book &mdash; momentum V2.5 filters loosened</div>
    </div>
  </div>

  <!-- CHARTS -->
  <div class="chart-section">
    <div class="chart-card">
      <div class="chart-title">CUMULATIVE PnL</div>
      <div class="chart-container">
        <canvas id="cumPnlChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <div class="chart-title">PER-TRADE PnL</div>
      <div class="chart-container">
        <canvas id="perTradePnlChart"></canvas>
      </div>
    </div>
  </div>

  <!-- TRADE LOG TABLE -->
  <div class="table-card">
    <div class="table-title">TRADE LOG</div>
    <div style="overflow-x:auto;">
      <table class="trade-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Time (MST)</th>
            <th>Bot</th>
            <th>Side</th>
            <th>Entry</th>
            <th>Cost</th>
            <th>Result</th>
            <th>PnL</th>
            <th>Cumulative</th>
          </tr>
        </thead>
        <tbody id="tradeLogBody"></tbody>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    Polymarket Live Dashboard V2.5 &nbsp;|&nbsp; Feb 19&ndash;20, 2026 &nbsp;|&nbsp; 17 trades across 2 strategies &nbsp;|&nbsp; Sniper V2.3 + Momentum V2.5 &nbsp;|&nbsp; Generated by Claude Code
  </div>

</div>

<script>
// ============================================================
// TRADE DATA — all 17 trades, chronologically sorted by UTC
// ============================================================
const trades = [
  { n:1,  utc:'2026-02-19T05:22:23Z', bot:'MOM', side:'DOWN', entry:0.47, cost:2.35, result:'WIN',  pnl: 2.65 },
  { n:2,  utc:'2026-02-19T09:04:02Z', bot:'SNP', side:'UP',   entry:0.70, cost:2.96, result:'LOSS', pnl:-2.96 },
  { n:3,  utc:'2026-02-19T09:14:07Z', bot:'SNP', side:'UP',   entry:0.70, cost:2.92, result:'WIN',  pnl: 1.25 },
  { n:4,  utc:'2026-02-19T10:24:02Z', bot:'SNP', side:'DOWN', entry:0.75, cost:3.16, result:'WIN',  pnl: 1.06 },
  { n:5,  utc:'2026-02-19T16:39:05Z', bot:'SNP', side:'DOWN', entry:0.70, cost:3.30, result:'WIN',  pnl: 1.41 },
  { n:6,  utc:'2026-02-19T16:44:04Z', bot:'SNP', side:'DOWN', entry:0.72, cost:3.38, result:'WIN',  pnl: 1.31 },
  { n:7,  utc:'2026-02-19T21:09:03Z', bot:'SNP', side:'DOWN', entry:0.75, cost:3.12, result:'WIN',  pnl: 1.04 },
  { n:8,  utc:'2026-02-19T22:24:05Z', bot:'SNP', side:'DOWN', entry:0.76, cost:2.34, result:'WIN',  pnl: 0.74 },
  { n:9,  utc:'2026-02-20T00:34:04Z', bot:'SNP', side:'DOWN', entry:0.78, cost:2.43, result:'WIN',  pnl: 0.69 },
  { n:10, utc:'2026-02-20T00:54:02Z', bot:'SNP', side:'DOWN', entry:0.71, cost:2.96, result:'WIN',  pnl: 1.21 },
  { n:11, utc:'2026-02-20T01:56:41Z', bot:'MOM', side:'UP',   entry:0.38, cost:3.04, result:'LOSS', pnl:-3.04 },
  { n:12, utc:'2026-02-20T04:04:04Z', bot:'SNP', side:'DOWN', entry:0.75, cost:3.16, result:'WIN',  pnl: 1.06 },
  { n:13, utc:'2026-02-20T07:54:05Z', bot:'SNP', side:'UP',   entry:0.75, cost:3.08, result:'WIN',  pnl: 1.03 },
  { n:14, utc:'2026-02-20T08:44:05Z', bot:'SNP', side:'DOWN', entry:0.80, cost:2.46, result:'WIN',  pnl: 0.61 },
  { n:15, utc:'2026-02-20T09:44:05Z', bot:'SNP', side:'UP',   entry:0.68, cost:2.84, result:'LOSS', pnl:-2.84 },
  { n:16, utc:'2026-02-20T11:04:04Z', bot:'SNP', side:'DOWN', entry:0.69, cost:2.88, result:'WIN',  pnl: 1.29 },
  { n:17, utc:'2026-02-20T12:54:06Z', bot:'SNP', side:'UP',   entry:0.71, cost:3.57, result:'LOSS', pnl:-3.57 }
];

// Compute cumulative PnL
let cumPnl = 0;
trades.forEach(t => { cumPnl += t.pnl; t.cumPnl = parseFloat(cumPnl.toFixed(2)); });

// MST formatter — full with date
function toMST(utcStr) {
  const d = new Date(utcStr);
  const mstMs = d.getTime() - 7 * 3600000;
  const m = new Date(mstMs);
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const mon = months[m.getUTCMonth()];
  const day = m.getUTCDate();
  let hr = m.getUTCHours();
  const min = String(m.getUTCMinutes()).padStart(2, '0');
  const ampm = hr >= 12 ? 'PM' : 'AM';
  if (hr === 0) hr = 12;
  else if (hr > 12) hr -= 12;
  return `${mon} ${day} ${hr}:${min} ${ampm}`;
}

// MST formatter — short for chart axis
function toMSTShort(utcStr, bot) {
  const d = new Date(utcStr);
  const mstMs = d.getTime() - 7 * 3600000;
  const m = new Date(mstMs);
  let hr = m.getUTCHours();
  const min = String(m.getUTCMinutes()).padStart(2, '0');
  const ampm = hr >= 12 ? 'p' : 'a';
  if (hr === 0) hr = 12;
  else if (hr > 12) hr -= 12;
  return `${hr}:${min}${ampm} ${bot}`;
}

// ============================================================
// MST CLOCK — live updating
// ============================================================
function updateClock() {
  const now = new Date();
  const utcMs = now.getTime() + now.getTimezoneOffset() * 60000;
  const mst = new Date(utcMs - 7 * 3600000);
  let hr = mst.getHours();
  const min = String(mst.getMinutes()).padStart(2, '0');
  const sec = String(mst.getSeconds()).padStart(2, '0');
  const ampm = hr >= 12 ? 'PM' : 'AM';
  if (hr === 0) hr = 12;
  else if (hr > 12) hr -= 12;
  document.getElementById('mst-clock').textContent = `${hr}:${min}:${sec} ${ampm} MST`;
}
updateClock();
setInterval(updateClock, 1000);

// ============================================================
// TRADE LOG TABLE
// ============================================================
const tbody = document.getElementById('tradeLogBody');
trades.forEach(t => {
  const tr = document.createElement('tr');
  const botClass = t.bot === 'MOM' ? 'bot-mom' : 'bot-snp';
  const sideClass = t.side === 'UP' ? 'side-up' : 'side-down';
  const resultClass = t.result === 'WIN' ? 'result-win' : 'result-loss';
  const pnlStr = t.pnl >= 0 ? `+$${t.pnl.toFixed(2)}` : `-$${Math.abs(t.pnl).toFixed(2)}`;
  const cumStr = t.cumPnl >= 0 ? `+$${t.cumPnl.toFixed(2)}` : `-$${Math.abs(t.cumPnl).toFixed(2)}`;
  const cumClass = t.cumPnl >= 0 ? 'result-win' : 'result-loss';

  tr.innerHTML = `
    <td style="color:var(--dim);">${t.n}</td>
    <td>${toMST(t.utc)}</td>
    <td class="${botClass}">${t.bot}</td>
    <td class="${sideClass}">${t.side}</td>
    <td>$${t.entry.toFixed(2)}</td>
    <td>$${t.cost.toFixed(2)}</td>
    <td class="${resultClass}">${t.result}</td>
    <td class="${resultClass}">${pnlStr}</td>
    <td class="${cumClass}">${cumStr}</td>
  `;
  tbody.appendChild(tr);
});

// ============================================================
// CHART STYLING HELPERS
// ============================================================
const chartFont = { family: "'JetBrains Mono', monospace", size: 11 };
const chartTooltip = {
  backgroundColor: 'rgba(16,16,32,0.95)',
  borderColor: '#00ffc3',
  borderWidth: 1,
  titleFont: { family: "'JetBrains Mono', monospace", size: 12, weight: '700' },
  bodyFont: { family: "'JetBrains Mono', monospace", size: 11 },
  titleColor: '#00ffc3',
  bodyColor: '#e0e6ed',
  padding: 10,
  cornerRadius: 6,
  displayColors: true
};

const gridColor = 'rgba(0,255,195,0.06)';
const tickColor = '#6b7a8d';

// ============================================================
// CUMULATIVE PNL CHART
// ============================================================
const cumLabels = trades.map(t => toMSTShort(t.utc, t.bot));
const cumData = trades.map(t => t.cumPnl);
const cumPointColors = trades.map(t => t.bot === 'MOM' ? '#a855f7' : '#00aaff');

const cumCtx = document.getElementById('cumPnlChart').getContext('2d');

const cumGradient = cumCtx.createLinearGradient(0, 0, 0, 300);
cumGradient.addColorStop(0, 'rgba(0,255,136,0.25)');
cumGradient.addColorStop(0.5, 'rgba(0,255,136,0.08)');
cumGradient.addColorStop(1, 'rgba(0,255,136,0.0)');

new Chart(cumCtx, {
  type: 'line',
  data: {
    labels: cumLabels,
    datasets: [{
      label: 'Cumulative PnL ($)',
      data: cumData,
      borderColor: '#00ff88',
      borderWidth: 2,
      backgroundColor: cumGradient,
      fill: true,
      tension: 0.3,
      pointRadius: 6,
      pointHoverRadius: 9,
      pointBackgroundColor: cumPointColors,
      pointBorderColor: cumPointColors,
      pointBorderWidth: 2
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: {
        ...chartTooltip,
        callbacks: {
          title: (items) => {
            const i = items[0].dataIndex;
            return `#${trades[i].n} ${trades[i].bot} | ${toMST(trades[i].utc)} MST`;
          },
          label: (item) => {
            const v = item.raw;
            return `Cumulative: ${v >= 0 ? '+' : ''}$${v.toFixed(2)}`;
          },
          afterLabel: (item) => {
            const i = item.dataIndex;
            const p = trades[i].pnl;
            return `Trade PnL: ${p >= 0 ? '+' : ''}$${p.toFixed(2)} (${trades[i].result})`;
          }
        }
      }
    },
    scales: {
      x: {
        ticks: { color: tickColor, font: { ...chartFont, size: 9 }, maxRotation: 55, minRotation: 35 },
        grid: { color: gridColor }
      },
      y: {
        ticks: {
          color: tickColor,
          font: chartFont,
          callback: v => (v >= 0 ? '+' : '') + '$' + v.toFixed(2)
        },
        grid: { color: gridColor }
      }
    }
  }
});

// ============================================================
// PER-TRADE PNL BAR CHART
// ============================================================
const barLabels = trades.map(t => toMSTShort(t.utc, t.bot));
const barData = trades.map(t => parseFloat(t.pnl.toFixed(2)));
const barColors = trades.map(t => {
  if (t.result === 'LOSS') return '#ff3355';
  return t.bot === 'MOM' ? '#a855f7' : '#00aaff';
});

const barCtx = document.getElementById('perTradePnlChart').getContext('2d');
new Chart(barCtx, {
  type: 'bar',
  data: {
    labels: barLabels,
    datasets: [{
      label: 'Trade PnL ($)',
      data: barData,
      backgroundColor: barColors,
      borderColor: barColors,
      borderWidth: 1,
      borderRadius: 4,
      borderSkipped: false
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: {
        ...chartTooltip,
        callbacks: {
          title: (items) => {
            const i = items[0].dataIndex;
            return `#${trades[i].n} ${trades[i].bot} | ${toMST(trades[i].utc)} MST`;
          },
          label: (item) => {
            const v = item.raw;
            const t = trades[item.dataIndex];
            return `${t.result}: ${v >= 0 ? '+' : ''}$${v.toFixed(2)}`;
          }
        }
      }
    },
    scales: {
      x: {
        ticks: { color: tickColor, font: { ...chartFont, size: 9 }, maxRotation: 55, minRotation: 35 },
        grid: { color: gridColor }
      },
      y: {
        ticks: {
          color: tickColor,
          font: chartFont,
          callback: v => (v >= 0 ? '+' : '') + '$' + v.toFixed(2)
        },
        grid: { color: gridColor },
        beginAtZero: false
      }
    }
  }
});
</script>
</body>
</html>